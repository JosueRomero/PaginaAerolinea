<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Journey HTML CSS Template</title>
<!-- 
Journey Template 
http://www.templatemo.com/tm-511-journey
-->
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">  <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">                <!-- Font Awesome -->
    <link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
    <link rel="stylesheet" type="text/css" href="css/datepicker.css"/>
    <link rel="stylesheet" type="text/css" href="slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>
    <link rel="stylesheet" href="css/templatemo-style.css">                                   <!-- Templatemo style -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
            <!--[if lt IE 9]>
              <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
              <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
      </head>

      <body>
        <div class="tm-main-content" id="top">
            <div class="tm-top-bar-bg"></div>    
            <div class="tm-top-bar" id="tm-top-bar">
                <div class="container">
                    <div class="row">
                        <nav class="navbar navbar-expand-lg narbar-light">
                            <a class="navbar-brand mr-auto" href="#">
                                <img src="img/logo.png" alt="Site logo">
                            </a>
                            
                            <div align="left"  id="mainNav" class="collapse navbar-collapse tm-bg-white">
								<!---------------LABEL-------------------->
                        </div>                            
                    </nav>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- .tm-top-bar -->

            <section class="p-5 tm-container-outer tm-bg-gray">
			<form id="form1" action="boletos.html" method="get" class="tm-form-seatSelect">
                <div class="containerV1">
			                   <!-- Aqui va la imagen del avion -->
					<div class="tm-avion">
						<table class="tm-table">
      						<tr>
								<td colspan="9" class="tm-header"><img width="100%" src="img/puntaAvion.jpg"></td>
							</tr>
							<tr class="tm-seat">
								<td class="tm-image-airplane" rowspan="16" align="center"><img src="img/avionIzquierda.jpg" ></td>
								<td id="a1">a1</td>
								<td id="b1">b1</td>
								<td id="c1">c1</td>
								<td class="tm-center-column">1</td>
								<td id="d1">d1</td>
								<td id="e1">e1</td>
								<td id="f1">f1</td>
								<td class="tm-image-airplane" rowspan="16" align="center"><img src="img/avionDerecha.jpg"></td>
							</tr>
							<tr class="tm-seat">
								<td id="a2">a2</td>
								<td id="b2">b2</td>
								<td id="c2">c2</td>
								<td class="tm-center-column">2</td>
								<td id="d2">d2</td>
								<td id="e2">e2</td>
								<td id="f2">f2</td>
							</tr>
							<tr class="tm-seat">
								<td id="a3">a3</td>
								<td id="b3">b3</td>
								<td id="c3">c3</td>
								<td class="tm-center-column">3</td>
								<td id="d3">d3</td>
								<td id="e3">e3</td>
								<td id="f3">f3</td>
							</tr>
							<tr class="tm-seat">
								<td id="a4">a4</td>
								<td id="b4">b4</td>
								<td id="c4">c4</td>
								<td class="tm-center-column">4</td>
								<td id="d4">d4</td>
								<td id="e4">e4</td>
								<td id="f4">f4</td>
							</tr>
							<tr class="tm-seat">
								<td id="a5">a5</td>
								<td id="b5">b5</td>
								<td id="c5">c5</td>
								<td class="tm-center-column">5</td>
								<td id="d5">d5</td>
								<td id="e5">e5</td>
								<td id="f5">f5</td>
							</tr>
							<tr class="tm-seat">
								<td id="a6">a6</td>
								<td id="b6">b6</td>
								<td id="c6">c6</td>
								<td class="tm-center-column">6</td>
								<td id="d6">d6</td>
								<td id="e6">e6</td>
								<td id="f6">f6</td>
							</tr>
							<tr class="tm-seat">
								<td id="a7">a7</td>
								<td id="b7">b7</td>
								<td id="c7">c7</td>
								<td class="tm-center-column">7</td>
								<td id="d7">d7</td>
								<td id="e7">e7</td>
								<td id="f7">f7</td>
							</tr>
							<tr class="tm-seat">
								<td id="a8">a8</td>
								<td id="b8">b8</td>
								<td id="c8">c8</td>
								<td class="tm-center-column">8</td>
								<td id="d8">d8</td>
								<td id="e8">e8</td>
								<td id="f8">f8</td>
							</tr>
							<tr class="tm-seat">
								<td id="a9">a9</td>
								<td id="b9">b9</td>
								<td id="c9">c9</td>
								<td class="tm-center-column">9</td>
								<td id="d9">d9</td>
								<td id="e9">e9</td>
								<td id="f9">f9</td>
							</tr>
							<tr class="tm-seat">
								<td id="a10">a10</td>
								<td id="b10">b10</td>
								<td id="c10">c10</td>
								<td class="tm-center-column">10</td>
								<td id="d10">d10</td>
								<td id="e10">e10</td>
								<td id="f10">f10</td>
							</tr>
							<tr class="tm-seat">
								<td id="a11">a11</td>
								<td id="b11">b11</td>
								<td id="c11">c11</td>
								<td class="tm-center-column">11</td>
								<td id="d11">d11</td>
								<td id="e11">e11</td>
								<td id="f11">f11</td>
							</tr>
							<tr class="tm-seat">
								<td id="a12">a12</td>
								<td id="b12">b12</td>
								<td id="c12">c12</td>
								<td class="tm-center-column">12</td>
								<td id="d12">d12</td>
								<td id="e12">e12</td>
								<td id="f12">f12</td>
							</tr>
							<tr class="tm-seat">
								<td id="a13">a13</td>
								<td id="b13">b13</td>
								<td id="c13">c13</td>
								<td class="tm-center-column">13</td>
								<td id="d13">d13</td>
								<td id="e13">e13</td>
								<td id="f13">f13</td>
							</tr>
							<tr class="tm-seat">
								<td id="a14">a14</td>
								<td id="b14">b14</td>
								<td id="c14">c14</td>
								<td class="tm-center-column">14</td>
								<td id="d14">d14</td>
								<td id="e14">e14</td>
								<td id="f14">f14</td>
							</tr>
							<tr class="tm-seat">
								<td id="a15">a15</td>
								<td id="b15">b15</td>
								<td id="c15">c15</td>
								<td class="tm-center-column">15</td>
								<td id="d15">d15</td>
								<td id="e15">e15</td>
								<td id="f15">f15</td>
							</tr>
							<tr class="tm-seat">
								<td id="a16">a16</td>
								<td id="b16">b16</td>
								<td id="c16">c16</td>
								<td class="tm-center-column">16</td>
								<td id="d16">d16</td>
								<td id="e16">e16</td>
								<td id="f16">f16</td>
							</tr>
     					</table>
					
					</div>
					
                </div> 
				<div class="containerV2 tm-font-seatLabel">
					<div class="tm-leyenda-2">
						<div class="tm-asientoOcupado tm-leyenda">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
						<div class="tm-leyenda">Ocupado</div>
					</div>
					<div class="tm-leyenda-2">
						<div class="tm-asientoLibre tm-leyenda">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
						<div class="tm-leyenda">Disponible</div>
					</div>
					<br>
					<label id="ax1">Adultos</label>
					<br>
					<label id="aa1">Asiento 1:</label>
					<input readonly class="tm-input-seat" type="text" name="aa1" id="aaa1">
					<!--<label id="asa1">Vacío</label>-->
					<br>
					<label id="aa2">Asiento 2:</label>
					<input readonly class="tm-input-seat" type="text" name="aa2" id="aaa2">
					<!--<label id="asa2">Vacío</label>-->
					<br>
					<label id="aa3">Asiento 3:</label>
					<input readonly class="tm-input-seat" type="text" name="aa3" id="aaa3">
					<br>
					<label id="aa4">Asiento 4:</label>
					<input readonly class="tm-input-seat" type="text" name="aa4" id="aaa4">
				</div>
				<div class="containerV3 tm-font-seatLabel">
					<br>
					<br>
					<br>
					<label id="ax2">Niños</label>
					<br>
					<label id="an1">Asiento 1:</label>
					<input readonly class="tm-input-seat" type="text" name="asn1" id="asn1">
					<br>
					<label id="an2">Asiento 2:</label>
					<input readonly class="tm-input-seat" type="text" name="asn2" id="asn2">
					<br>
					<label id="an3">Asiento 3:</label>
					<input readonly class="tm-input-seat" type="text" name="asn3" id="asn3">
					<br>
					<label id="an4">Asiento 4:</label>
					<input readonly class="tm-input-seat" type="text" name="asn4" id="asn4">
					<br>
					<br>
					<button type="submit" class="btn btn-primary tm-btn tm-btn-search text-uppercase" id="btnSubmit">Continuar</button>
				</div>
			</form>
				
            </section>
            <footer class="tm-container-outer">
                <p class="mb-0">Copyright © <span class="tm-current-year">2018</span> United. 
					Diseñado por Salvador y Josué</p>
            </footer>
        </div>
    </div> <!-- .main-content -->

    <!-- load JS files -->
    <script src="js/jquery-1.11.3.min.js"></script>             <!-- jQuery (https://jquery.com/download/) -->
    <script src="js/popper.min.js"></script>                    <!-- https://popper.js.org/ -->       
    <script src="js/bootstrap.min.js"></script>                 <!-- https://getbootstrap.com/ -->
    <script src="js/datepicker.min.js"></script>                <!-- https://github.com/qodesmith/datepicker -->
    <script src="js/jquery.singlePageNav.min.js"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
    <script src="slick/slick.min.js"></script>                  <!-- http://kenwheeler.github.io/slick/ -->
    <script src="js/jquery.scrollTo.min.js"></script>   
	
	<!-- https://github.com/flesler/jquery.scrollTo -->
    <script> 
		// JavaScript Document
	window.onload = function(){
		var datos = localStorage.getItem("info");
		var ruta = localStorage.getItem("od");
		var horario = localStorage.getItem("ho");
		var fechaVuelo = localStorage.getItem("fe");
		localStorage.clear();
		localStorage.setItem("od",ruta);
		localStorage.setItem("ho",horario);
		localStorage.setItem("fe",fechaVuelo);
		var asientosAdulto = parseInt(datos.split("-")[5],10);
		var asientosNiño = parseInt(datos.split("-")[7],10);
		
		if(parseInt(asientosAdulto) == 0)
			document.getElementById("ax1").style.display = 'none';
		if(parseInt(asientosNiño) == 0)
			document.getElementById("ax2").style.display = 'none';

		var totalAdultSeats = guardarElementosDOM("aaa");
		var totalAdultSeatsLabel = guardarElementosDOM("aa");
		var totalKidSeats = guardarElementosDOM("asn");
		var totalKidSeatsLabel = guardarElementosDOM("an");

		var myHash = new Hash();
		var totalAsientos = parseInt(asientosAdulto) + parseInt(asientosNiño);
		
		var adultInputs = colocarElementosNecesarios(totalAdultSeats,totalAdultSeatsLabel,asientosAdulto,"aaa");
		var kidsInputs = colocarElementosNecesarios(totalKidSeats,totalKidSeatsLabel,asientosNiño,"asn");

		document.getElementById("form1").onsubmit = function(){return validacion()};
		
		//Hay 96 asientos
		var asientosOcupados = new Array();
		var asientosSeleccionados = new Array();
		var letraAsiento = ['a','b','c','d','e','f'];

		//Extaemos los asientos ocupados de la BD
		<?php
			//Extaemos los asientos ocupados de la BD
			$db = new mysqli("localhost","root","","aerolinea");

			$consulta = "SELECT vuCl_Boleto FROM vuelo_cliente";
			$asientoOcup = $db->query($consulta);

			$cont = 0;
			while ($asientosArray[$cont] = $asientoOcup->fetch_array(MYSQLI_NUM)){
				$cont++;
			}
		
			for($i=0; $i < count($asientosArray)-1; $i++ ){
					echo 'asientosOcupados['.$i.'] = "'.$asientosArray[$i][0].'";';
			}

		?>

		//Definimos los asientos ocupados
		var asientoActual;
		for(var i = 0; i < asientosOcupados.length; i++){
			//asientosOcupados[i] = letraAsiento[Math.round(Math.random()*5)]+""+(1+Math.round(Math.random()*15));
			asientoActual = document.getElementById(asientosOcupados[i]);
			asientoActual.style.background = "red";
		}

		//Se crea el evento de click en la tabla
		var asiento = document.querySelector("table");
		asiento.addEventListener("click",function(e){
			//Solo se podran hacer click los TD
			if(e.target.tagName == "TD"){
				//Comprobamos que el TD seleccionado sea un asiento y no el pasillo
				let siEsAsiento = false;
				for(var i = 0; i < 96;i++){
					for(var j = 0; j < 6; j++){
						if(e.target.id == (letraAsiento[j]+""+(i+1)))
							siEsAsiento = true;
					}

				}

				let asientoOcupado = false;
				let asientoSeleccionado = document.getElementById(e.target.id);
				if(siEsAsiento){
					//Se comprueba que no sea de los que estan ocupados
					for(let i = 0; i < 10; i++){
						if(e.target.id == asientosOcupados[i])
							asientoOcupado = true;
					}
					let asientoSeleccionadoPreviamente = false;
					if(!asientoOcupado){
						//Se comprueba si ya se selecciono el asiento anteriormente en esa sesión
						for(let i = 0; i < asientosSeleccionados.length;i++){
							if(asientosSeleccionados[i] == e.target.id)
								asientoSeleccionadoPreviamente = true;

						}
						//Si no se ha seleccionado previamente se agrega al arreglo y se cambia su color a rojo
						if(!asientoSeleccionadoPreviamente){
							let lleno = true;
							let slotVacio = ""
							//Se agrega al control el asiento y su respectivo input
							for(let i = 0; i <= totalAsientos; i++ ){
								if(myHash.getItem('asn'+i) == 'vacío'){
									lleno = false;
									slotVacio = ('asn'+i);
								}
								if(myHash.getItem('aaa'+i) == 'vacío'){
									lleno = false;
									slotVacio = ('aaa'+i);
									break;
								}
							}
							if(!lleno){
								//console.log(slotVacio);
								myHash.setItem(slotVacio,e.target.id);
								document.getElementById(slotVacio).value = e.target.id;
								//console.log(myHash.items);
								asientosSeleccionados.push(e.target.id+"");
								asientoSeleccionado.style.background = "red";
							}

						}else{
							//Si ya se seleccionó previamente se saca del arreglo y vuelve su color normal
							for(let i = 0; i < asientosSeleccionados.length; i++){
								if(asientosSeleccionados[i] == e.target.id)
									asientosSeleccionados.splice(i,1);
							}
							for(let i = 0; i <= totalAsientos; i++ ){
								//Revisa donde esta el asiento que se va a remover y lo quita
								if(myHash.getItem('aaa'+i) == e.target.id){
									myHash.setItem('aaa'+i,'vacío');
									document.getElementById('aaa'+i).value = '';
								}
							if(myHash.getItem('asn'+i) == e.target.id){
									myHash.setItem('asn'+i,'vacío');
									document.getElementById('asn'+i).value = '';
								}

							}
							asientoSeleccionado.style.background = "rgba(37,128,224,1.00)";
						}
					}
				}
			}
		});

		function guardarElementosDOM(id_dom){
			let arr = new Array();
			for(let i = 1;i < 5; i++){
				arr[i-1] = document.getElementById(id_dom+""+i);
			}
			return arr;
		}

		function colocarElementosNecesarios(arr1,arr2,valor,id_dom){
			let asientosDispo = new Array();
			for(i = valor;i < 4; i++){
				arr1[i].style.display = 'none';
				arr1[i].disabled = true;
				arr2[i].style.display = 'none';
				arr2[i].disabled = true;
			}
			for(let i = 0; i < valor; i++){
				myHash.setItem((id_dom+""+(i+1)),'vacío');
			}
			for(let i = 0; i < valor; i++){
				asientosDispo[i] = arr1[i];
			}
			return asientosDispo;
		}

		function Hash() { 
			this.length = 0; 
			this.items = new Array(); 
			for (var i = 0; i < arguments.length; i += 2) { 
				if (typeof(arguments[i + 1]) != 'undefined') { 
					this.items[arguments[i]] = arguments[i + 1]; 
					this.length++; } 
			} 
			this.removeItem = function(in_key) { 
				var tmp_value; 
				if (typeof(this.items[in_key]) != 'undefined') { 
					this.length--; 
					var tmp_value = this.items[in_key]; 
					delete this.items[in_key]; 
				} 
				return tmp_value; 
			} 
			this.getItem = function(in_key) { 
				return this.items[in_key]; 
			} 
			this.setItem = function(in_key, in_value) { 
				if (typeof(in_value) != 'undefined') { 
					if (typeof(this.items[in_key]) == 'undefined') { 
						this.length++; 
					} 
					this.items[in_key] = in_value; 
				} return in_value; 
			} 
			this.hasItem = function(in_key) { 
				return typeof(this.items[in_key]) != 'undefined'; 
			} 
		}
		
		//LOCAL STORAGE
		document.getElementById("btnSubmit").addEventListener("click",function(){
			localStorage.setItem("info",datos);
			
		});
		
		function validacion(){
			for(let i = 0; i < adultInputs.length; i++){
				if(adultInputs[i].value == null || adultInputs[i].value.length == 0)
					return false;
			}
			for(let i = 0; i < kidsInputs.length; i++){
				if(kidsInputs[i].value == null || kidsInputs[i].value.length == 0)
					return false;
			}
			
			return true;
		}

	}
		
        /* DOM is ready
        ------------------------------------------------*/
        $(function(){

            // Change top navbar on scroll
            $(window).on("scroll", function() {
                if($(window).scrollTop() > 100) {
                    $(".tm-top-bar").addClass("active");
                } else {                    
                 $(".tm-top-bar").removeClass("active");
                }
            });

            // Smooth scroll to search form
            $('.tm-down-arrow-link').click(function(){
                $.scrollTo('#tm-section-search', 300, {easing:'linear'});
            });

            // Update nav links on scroll
            $('#tm-top-bar').singlePageNav({
                currentClass:'active',
                offset: 60
            });

            // Close navbar after clicked
            $('.nav-link').click(function(){
                $('#mainNav').removeClass('show');
            });

            // Slick Carousel
            $('.tm-slideshow').slick({
                infinite: true,
                arrows: true,
                slidesToShow: 1,
                slidesToScroll: 1
            });
             
            $('.tm-current-year').text(new Date().getFullYear());  // Update year in copyright           
        });
		
		

    </script>             

</body>
</html>